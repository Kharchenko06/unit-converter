<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–µ–ª–∏—á–∏–Ω</title>

        <style>
            /* --- –ù–ê–°–¢–†–û–ô–ö–ò –î–ò–ó–ê–ô–ù–ê (CSS) --- */

            /* –¶–≤–µ—Ç–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
            :root {
                --bg-color: #f0f2f5;
                --card-bg: #ffffff;
                --text-main: #2d3748;
                --text-sec: #718096;
                --accent: #3b82f6;      /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç */
                --accent-hover: #2563ed;
                --border: #e2e8f0;
                --input-bg: #f7fafc;
                --result-bg: #eff6ff;
                --result-border: #bfdbfe;
                --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }

            /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ) */
            @media (prefers-color-scheme: dark) {
                :root {
                    --bg-color: #1a202c;
                    --card-bg: #2d3748;
                    --text-main: #f7fafc;
                    --text-sec: #a0aec0;
                    --accent: #63b3ed;      
                    --accent-hover: #4299e1;
                    --border: #4a5568;
                    --input-bg: #171923;
                    --result-bg: #2c5282;
                    --result-border: #4299e1;
                    --shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
                }
            }

            /* –°–±—Ä–æ—Å –æ—Ç—Å—Ç—É–ø–æ–≤ */
            * { box-sizing: border-box; margin: 0; padding: 0; }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                background-color: var(--bg-color);
                color: var(--text-main);
                min-height: 100vh;
                display: flex;      /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
                justify-content: center;
                align-items: center;
                padding: 20px;
            }

            /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
            .card {
                background: var(--card-bg);
                width: 100%;
                max-width: 480px;       /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã */
                padding: 35px;
                border-radius: 24px;
                box-shadow: var(--shadow);
            }

            h1 {
                text-align: center;
                margin-bottom: 25px;
                font-size: 26px;
                font-weight: 800;
            }

            /* –í–∫–ª–∞–¥–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
            .tabs {
                display: flex;
                gap: 8px;
                overflow-x: auto;   /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
                padding-bottom: 12px;
                margin-bottom: 25px;
                border-bottom: 1px solid var(--border);
                scrollbar-width: none; /* –°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä (Firefox) */
            }
            .tabs::-webkit-scrollbar { display: none; } /*–°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä (Chrome) */

            .tab {
                text-decoration: none;
                color: var(--text-sec);
                padding: 8px 16px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                white-space: nowrap;
                transition: all 0.2s ease;
                background-color: transparent;
            }

            .tab:hover {background: var(--input-bg); }

            /* –ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ */
            .tab.active {
                background: var(--accent);
                color: white;
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            }

            /* –°–µ—Ç–∫–∞ —Ñ–æ—Ä–º—ã */
            .form-grid {display: grid; gap: 20px; }

            label {
                font-size: 13px;
                color: var(--text-sec);
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
            }

            /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
            input, select {
                width: 100%;
                padding: 14px;
                background: var(--input-bg);
                border: 2px solid var(--border);
                border-radius: 12px;
                color: var(--text-main);
                font-size: 16px;
                outline: none;
                transition: border-color 0.2s;
                appearance: none; /* –£–±—Ä–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ */
            }

            input:focus, select:focus { border-color: var(--accent); }

            /* –†—è–¥ –≤—ã–±–æ—Ä–∞ –µ–¥–∏–Ω–∏—Ü (Form -> Swap -> To) */
            .units-row {
                display: flex;
                align-items: flex-end;
                gap: 12px;
            }

            .unit-box { flex: 1; position: relative; }

            /* –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—É—é —Å—Ç—Ä–µ–ª–æ—á–∫—É –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ */
            .unit-box::after {
                content: "‚ñº";
                font-size: 10px;
                position: absolute;
                right: 14px;
                top: 42px; /* –ü–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –≤—ã—Å–æ—Ç—É label */
                color: var(--text-sec);
                pointer-events: none;
            }

            /* –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã –º–µ—Å—Ç (Swap) */
            .swap-btn {
                background: var(--input-bg);
                border: 2px solid var(--border);
                color: var(--accent);
                width: 48px; height: 48px;
                border-radius: 12px;
                cursor: pointer;
                font-size: 20px;
                flex-shrink: 0;
                display: flex; align-items: center; justify-content: center;
                transition: all 0.2s;
            }
            .swap-btn:hover {
                border-color: var(--accent);
                background-color: var(--bg-color);
            }

            /* –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è */
            .action-btn {
                width: 100%;
                padding: 16px;
                background: var(--accent);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                margin-top: 5px;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }
            .action-btn:hover {background: var(--accent-hover); }
            .action-btn:active { transform: scale(0.98); }

            /* –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
            .result-box {
                margin-top: 30px;
                background: var(--result-bg);
                padding: 25px;
                border-radius: 16px;
                text-align: center;
                border: 1px dashed var(--result-border);
                animation: fadeIn 0.4s ease;
            }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to {opacity: 1; transform: translateY(0); } }

            .res-main { font-size: 28px; font-weight: 800; word-break: break-word; color: var(--accent); }
            .res-sub { font-size: 15px; color: var(--text-sec); margin-top: 8px; }

            /* –ò—Å—Ç–æ—Ä–∏—è */
            .history {margin-top: 35px; border-top: 1px solid var(--border); padding-top: 20px; }
            .history h3 { font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-sec); margin-bottom: 15px; }
            .history ul { list-style: none; }

            .history li {
                font-size: 14px;
                padding: 12px;
                background: var(--input-bg);
                border-radius: 8px;
                margin-bottom: 8px;
                display: flex; justify-content: space-between;
                color: var(--text-main);
            }
        </style>
    </head>
    <body>

        <div class="card">
            <h1>üîÅ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</h1>

            <div class="tabs">
                {% for code, data in units_data.items() %}
                    <a href="/?category={{ code }}" 
                    class="tab {{ 'active' if current_cat == code else '' }}">
                    {{ data['name'] }}
                    </a>
                {% endfor %}
            </div>

            <form method="POST">
                <input type="hidden" name="category" value="{{ current_cat }}">

                <div class="form-grid">
                    
                    <div>
                        <label>–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</label>
                        <input type="number" step="any" name="amount" value="{{ amount }}" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100">
                    </div>

                    <div class="units-row">
                        <div class="unit-box">
                            <label>–ò–∑:</label>
                            <select name="unit_from">
                                {% for code, u in units_data[current_cat]['units'].items() %}
                                    <option value="{{ code }}" {% if unit_from is equalto code %}selected{% endif %}>
                                        {{ u['name'] }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" name="action" value="swap" class="swap-btn" title="–ü–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏">
                            ‚áÖ
                        </button>

                        <div class="unit-box">
                            <label>–í:</label>
                            <select name="unit_to">
                                {% for code, u in units_data[current_cat]['units'].items() %}
                                    <option value="{{ code }}" {% if unit_from is equalto code %}selected{% endif %}>
                                        {{ u['name'] }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <button type="submit" name="action" value="convert" class="action-btn">
                        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
                    </button>
                </div>
            </form>

            {% if result %}
            <div class="result-box">
                <div class="res-main">{{ result }}</div>
                <div class="res-sub">{{ explanation }}</div>
            </div>
            {% endif %}

            {% if history %}
            <div class="history">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π</h3>
                <ul>
                    {% for item in history %}
                        <li>
                            <span>{{ item.from_val }}</span>
                            <span style="color: var(--text-sec);">‚Üí</span>
                            <span style="font-weight: bold;">{{ item.to_val }}</span>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

        </div>

    </body>
</html>